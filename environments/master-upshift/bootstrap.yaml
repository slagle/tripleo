- name: Bootstrap tasks
  hosts: all
  gather_facts: no
  any_errors_fatal: true
  tasks:
    - name: rm -rf .ssh/known_hosts
      delegate_to: localhost
      run_once: true
      shell:
        rm -rf ~/.ssh/known_hosts
    - name: ssh-keygen -R / ssh-keyscan
      delegate_to: localhost
      shell: |
        ssh-keygen -R {{ hostvars[inventory_hostname]['ansible_host'] }}
        ssh-keyscan {{ hostvars[inventory_hostname]['ansible_host'] }} >> ~/.ssh/known_hosts
    - name: tripleo-repos
      shell: |
        rpm -q git || sudo yum -y install git
        sudo yum -y install python-setuptools python-requests
        rm -rf tripleo-repos
        git clone https://git.openstack.org/openstack/tripleo-repos
        pushd tripleo-repos
        sudo python setup.py install
        popd
        sudo tripleo-repos current-tripleo-dev
      tags:
        - tripleo-repos
    - name: dhclient eth1
      shell:
        dhclient eth1
      become: true
      tags:
        - eth1
    - name: permissive selinux
      become: true
      selinux:
        state: permissive
        policy: targeted
      tags:
        - selinux
